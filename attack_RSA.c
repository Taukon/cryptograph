#include<stdio.h>
#include<gmp.h>


int main(void){

    mpz_t n[5],nn[3],c[3],b[3],invert[3];
    //公開鍵n
    mpz_init_set_str(n[0],"423768087682366715891707499716557186804444107073866652926338337711536652290607755905257478708595398502320246903122466707595378614385349844850632427212392667473625650651785461500431340754465691030460402338509435182214569652671268881255544398249816664281740476666218801041436857342751985784336696531053675544180985801336504666465130820774453495111488956546520198093635791402183225551118850520280656920068229936839843668924654898243900534937610870239853475851964769252773293306847105531141187073413919448565045024893845153940148004815496967445046131166223717232519315004806890333896328937011296681454348350041275115177",10);
    mpz_init_set_str(n[1],"1409561040023257972002975952019296733638670545898689004162805440790674826531711636987554645381894742393033358639738739056855342395096528470836763098950069079839171151992863840145064178073510337227809071794202883726426610843360565983942662442604881173681217941049010630413523826861519287132841836445360419641846855894622357454138907593654040426620211091702929139659095229085563127312590487635933047792286903368425014206890097357247114655026652525958298094578280577031809847051501818437153789636857508435775074533707885763323757672241312568184088089151240514956714715159345415652485918595308178811219519007883318001431",10);
    mpz_init_set_str(n[2],"1319963967402585192515825335188623818282000653069570374791461829060971685194259602877958468112595212111930170688651177215612391092465327254864007964968639001475017319292048947976491956511663389638016979855419118831528527022303142447185861246656338709295563890486336177116226141483847675446661364460908156562751793911334755838853790646093084251848190578922896150543048778572924778504107324917393664503193302467243939344230334344390105362470589416295286618836067257869327295935897889767785194775060769527575860843779855814055376347319841789451304295724936752782309157385509509106013374739210931400743760685028833160417",10);
    mpz_init(n[3]);
    mpz_init(n[4]);
    //暗号文c
    mpz_init_set_str(c[0],"124149920664486374167018174910649026335511706856943607942147535552411449952666108429008663335056180897227409376237027358603969812601276911303509579015132461181622574508087763563838758099372492030493808711162364688189458921571853740756177278538283476940357885919178585144161339040399467199311962913810562416221478654493091636902668075795416160856139731116703070206707075730226033210038601118109111772078491513297358190442379128095350233828973831218399141045283487613451944116203868365461514708403882881318693994496196913866532968093768170371808832769962346749997450114656023197799905147234207165753549487079957287815",10);
    mpz_init_set_str(c[1],"875769091232550861234143351282317855824092767354700237497772183951740113037635720817069785226416266793403084625194780017656556282810076548147443169064054552997087634571085249199696677333981390747652921991985888372351522827465827301280936663708155821397697294653880743597940747152281865913772762913307843900007365394034264416831424972914004331765427728992682111751474660689170699379801675462332249419205385313965048936759966994053839873460215287971491774833886014058806510546281616852727675645841937510271457234283429958956286539514727297223373062471626004077851458501844315897935146407772940899399105382551563393286",10);
    mpz_init_set_str(c[2],"566941464043117338438135816478768574986491139844867547534200837308300011955208557270677853166919825459170247298974936185624081627279958150228949909995792239910235228818806804227424682893429156536458620589902993806630994678963612050300510763100439288992225130669120317969088449858567420469873358897000597451681157383297777952130921478907367629630122676723236152342906668215727185209564504284087014355162405214052960301396389404807225743332331865628215198497939888772571097506754626494884864287774152581981041490359628808735963621092726340586003223659386578482367132222603680626292717830622581196168349951576001807405",10);

    for(int i=0; i<3; i++){
        mpz_init(nn[i]);
        mpz_init(b[i]);
        mpz_init(invert[i]);
    }


    mpz_mul(n[3],n[0],n[1]);
    mpz_mul(n[4],n[3],n[2]);   //////全ての法nの積


    mpz_t a,x;
    mpz_init(a);
    mpz_init(x);

    //中国剰余定理
    for(int i=0; i<3; i++){
        mpz_div(nn[i],n[4],n[i]);
        mpz_invert(invert[i],nn[i],n[i]);
        mpz_mul(a,nn[i],invert[i]);
        mpz_mul(b[i],c[i],a);  
    }

    //c[i],n[i],nn[i]のメモリ開放
    for(int i=0; i<3; i++){
        mpz_clear(c[i]);
        mpz_clear(n[i]);
        mpz_clear(nn[i]);
        mpz_clear(invert[i]);
    }

    //中国剰余定理の続き
    mpz_add(a,b[0],b[1]);
    mpz_add(x,a,b[2]);      //xとm^eは、n[4]を法として合同


    mpz_t me,m;         //meは、m^e
    mpz_init(me);
    mpz_mod(me,x,n[4]);
    mpz_init(m);
    mpz_root(m,me,513);
    gmp_printf("m: %Zd\n\n",m);

    unsigned int ans = mpz_get_ui(m);
    printf("平文: %c\n\n",ans);


    //me,m,n[3],n[4],a,xのメモリ開放
    mpz_clears(me,m,n[3],n[4],a,x,NULL);
    //b[i]のメモリ開放
    for(int i=0; i<3; i++){
        mpz_clear(b[i]);
    }

    return 0;
}